<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.zhanghua.ssm.mapper.sys.TestMapper">

	<!-- 查询 -->
	<select id="get" resultType="Test">
		SELECT t.* FROM t_test t WHERE
		t.id=#{id}
	</select>

	<select id="queryList" resultType="Test">
		SELECT t.*,u.nickname AS "createUser.nickname" FROM t_test t
		LEFT JOIN
		sys_user u ON u.id = t.create_user_id
		WHERE t.is_delete=0
		<if test="name != null and name != ''">
			AND t.name LIKE CONCAT('%',#{name},'%')
		</if>
		<if test="remark != null and remark != ''">
			AND t.remark LIKE CONCAT('%',#{remark},'%')
		</if>
		<if
			test="createUser != null and createUser.nickname != null and createUser.nickname != ''">
			AND u.nickname LIKE CONCAT('%',#{createUser.nickname},'%')
		</if>
		<if test="createStartTime != null and createStartTime != ''">
			<![CDATA[AND DATE_FORMAT(t.create_time, '%Y-%m-%d') >= DATE_FORMAT(#{createStartTime}, '%Y-%m-%d')]]>
		</if>
		<if test="createEndTime != null and createEndTime != ''">
			<![CDATA[AND DATE_FORMAT(t.create_time, '%Y-%m-%d') <= DATE_FORMAT(#{createEndTime}, '%Y-%m-%d')]]>
		</if>
		ORDER BY t.create_time DESC
	</select>
	<insert id="save">
		INSERT INTO t_test(
		id,
		name,
		remark,
		create_time,
		create_user_id
		)
		VALUES(
		#{id},
		#{name},
		#{remark},
		#{createTime},
		#{createUser.id}
		)
	</insert>
	
	<update id="update">
		UPDATE t_test SET
		name = #{name},
		remark = #{remark},
		update_time = #{createTime},
		update_user_id = #{updateUser.id}
		WHERE id = #{id}
	</update>
	
	<!-- 删除 -->
	<update id="delete">
		UPDATE t_test SET
		is_delete=1
		WHERE id IN
		<foreach collection="list" item="id" index="index" open="(" separator="," close=")">
    	 #{id}
    	</foreach>
	</update>
</mapper>