<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.BBS.dao.UserDao">
    <!-- 目的：为dao接口方法提供sql语句配置 -->

    <resultMap id="userMap" type="com.BBS.pojo.User">
        <result column="roleid" property="roleid"/><result column="sex" property="sex"/>
        <result column="user_name" property="username"/><result column="login_name" property="loginname"/>
        <result column="pic_path" property="picPath"/><result column="password" property="password"/>
        <result column="phone" property="phone"/><result column="radate" property="radate"/>
        <result column="email" property="email"/><result column="status" property="status"/>
        <result column="del_flag" property="del_flag"/><result column="signature" property="signature"/>
        <result column="join_date" property="joindate"/><result column="place" property="place"/>
        <result column="is_check_in" property="isCheckIn"/>
    </resultMap>

    <!-- 如果输入参数的类型是简单类型，#{}的占位符输入参数可以任意 ，输出结果集返回的类型是返回java对象，例如pojo,javabean类接收-->
    <select id="queryById"  parameterType="java.lang.Integer" resultType="com.BBS.pojo.User" resultMap="userMap">
        <!-- 具体的sql -->
        SELECT
        password,username
        FROM
        b_user
        WHERE
        ID = #{id}
    </select>

    <!-- 插入数据，是插入的数据类型，是pojo或javabean对象，这些对象存储了属性值-->
    <insert id="insertByUser" parameterType="com.BBS.pojo.User">
        INSERT  INTO  b_user(ID,roleid,sex,username,loginname ,password,signature,phone,email,radate,status,del_flag,joindate,place)
         VALUE(#{id},#{roleid},#{sex},#{username},#{loginname},#{password},#{signature},#{phone},#{email},#{radate},#{status},#{del_flag},#{joindate},#{place})
    </insert>

    <!-- 删除数据，根据用户的id来删除用户信息。这里指的主键值-->
    <delete id="deleteByid"  parameterType="java.lang.Integer">
        DELETE  FROM  b_user  WHERE  ID = #{id}
    </delete>

<!-- 传入的参数是用户，但是里面必须包含用户对象的ID或者主键值，要不然的话就会更新所有表中的所有数据-->
    <update id="updateById" parameterType="com.BBS.pojo.User">
        UPDATE  b_user  SET name =#{NAME } WHERE  ID =#{id}
    </update>

    <select id="findByLoginnameAndLoginpass" parameterType="map" resultType="com.BBS.pojo.User" resultMap="userMap">
        select *
        from b_user
        where username=#{user_name} and password=#{password}
    </select>

    <select id="findByLoginName" parameterType="java.lang.String" resultType="com.BBS.pojo.User" resultMap="userMap">
        select *
        from b_user
        where loginname=#{login_name} OR ID = #{id}
    </select>

    <select id="personal" parameterType="java.lang.String" resultType="java.util.Map" >
        select a.ID,a.roleid,a.sex,a.username,a.signature,a.joindate,a.phone,a.email,a.place,
            b.forum_id,b.title,b.make_date,b.read_times,b.reply_times,b.delicate_status,b.make_time
        from
            b_user a  join b_forum b on a.ID= b.main_id
        where
            b.del_flag!=1 and b.main_id=#{userid}
    </select>

    <select id="Recently_answered" parameterType="java.lang.String" resultType="java.util.Map">

        select *  from b_replyforum  where reply_author = #{replyauthor} group by title

    </select>

    <select id="findByusername" parameterType="java.lang.String" resultType="java.lang.String">
         select username
        from b_user
        where username=#{username}
    </select>

    <select id="finfByloginname" parameterType="java.lang.String" resultType="java.lang.String">
            select loginname
        from b_user
        where loginname=#{login_name}
    </select>

    <select id="userlist" resultType="java.util.List">
        SELECT  *  from b_user
    </select>

    <select id="findByParams" resultType="java.util.HashMap">
        SELECT  *  from b_user
    </select>

    <!-- 更新用户信息-->
    <update id="updateuser" parameterType="com.BBS.pojo.User" >
        UPDATE  b_user  SET
            ID=#{id},roleid=#{roleid},sex=#{sex},
            signature =#{signature },phone =#{phone },
            email =#{email },radate =#{radate },
            status=#{status},del_flag=#{del_flag},
            place=#{place},forum_score=#{forum_score}
        WHERE   ID =#{id}
    </update>

</mapper>
